<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CM's Lending Manager</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

  <button id="menuToggle" class="menu-toggle">â˜°</button>
  <div id="sidebarOverlay" class="sidebar-overlay"></div>

  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <h3>âš™ï¸ Global Settings</h3>
      <label>Penalty Amount (â‚±)</label>
      <input type="number" id="setPenaltyAmount" placeholder="50">
      <label>Penalty Interval (Hours)</label>
      <input type="number" id="setPenaltyHours" placeholder="5">
      <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">
      <h4 style="margin: 0 0 10px 0; color: #555;">âœï¸ Default Lender Signatures</h4>
      <p style="font-size: 12px; color: #888; margin-bottom: 10px;">Upload your signatures here once.</p>
      <label>Lender 1 Signature (Wife)</label>
      <input type="file" id="setLenderSig1" accept="image/*">
      <label>Lender 2 Signature (Husband)</label>
      <input type="file" id="setLenderSig2" accept="image/*">
      <button class="save-btn" onclick="saveSettings()">ğŸ’¾ Save Settings & Signatures</button>
    </div>
  </div>

  <div id="contractModal" class="modal" style="z-index: 1000; align-items: flex-start; padding-top: 50px;">
    <div class="modal-content" style="max-width: 850px; width: 95%; max-height: 85vh; overflow-y: auto; padding: 20px; background: #333;">
      <div style="text-align: center; margin-bottom: 15px; position: sticky; top: 0; z-index: 100;">
        <button onclick="closeContractModal()" style="background: #ff4d4d; color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-right: 10px;">âœ– Close</button>
        <button onclick="downloadContractImage()" style="background: #2ecc71; color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">â¬‡ï¸ Download Image Now</button>
      </div>
      <div id="contract-display-area" style="background: white; padding: 40px; margin: 0 auto;"></div>
    </div>
  </div>

  <div class="app-wrapper">
    <div class="sidebar">
      <div class="brand">CM's Lending</div>
      <div class="borrower-list" id="borrowerTabs"></div>
      <button class="add-new-btn" onclick="showCreateScreen()">+ New Borrower</button>
      <div class="credit-count" id="creditCount">Borrowers (Unlimited)</div>
      <button class="settings-btn-side" onclick="openSettings()">âš™ï¸ Settings</button>
    </div>

    <div class="main-content">
      <div id="createScreen" class="screen-panel">
        <h1>Create New Loan</h1>
        <div class="section-box">
          <label>Lender Name(s) (For Contract)</label>
          <input type="text" id="lenderName" placeholder="e.g., Mr. & Mrs. Rodeadilla">
          <hr style="border:0; border-top:1px dashed #ccc; margin: 20px 0;">
          <label>Borrower's Name</label>
          <input type="text" id="newBorrowerName" placeholder="Juan Dela Cruz">
          <label>Borrower's Address</label>
          <input type="text" id="newAddress" placeholder="Complete Address">
          <label>Contact Number</label>
          <input type="tel" id="newContactNumber" placeholder="0912 345 6789">
          <div class="row">
            <div class="half">
              <label>Principal (â‚±)</label>
              <input type="text" id="newPrincipal" oninput="formatInput(this)">
            </div>
            <div class="half">
              <label>Interest (%)</label>
              <input type="number" id="newInterest" value="20">
            </div>
          </div>
          <label>Loan Date</label>
          <input type="date" id="newLoanDate">
          <label style="color:#d35400;">Payment Due Date</label>
          <input type="date" id="newDueDate">
          <label>Relative's Info (Name & Contact)</label>
          <input type="text" id="newRelativeInfo" placeholder="Emergency Contact">
          <div style="margin-top:20px; background:#fff8e1; padding:15px; border-radius:10px;">
            <p style="margin:0 0 10px 0; font-weight:bold; color:#d35400;">ğŸ“ Requirements</p>
            <label>ğŸ“¸ Valid ID</label>
            <input type="file" id="newValidID" accept="image/*">
            <label>âœï¸ E-Signature (Borrower)</label>
            <input type="file" id="newSignature" accept="image/*">
          </div>
          <div class="button-group" style="flex-direction: row; gap: 10px; flex-wrap: wrap;">
             <button class="copy-btn" onclick="previewContract()" style="flex:1; min-width: 200px;">ğŸ“„ Preview & Download Contract</button>
             <button class="save-borrower-btn" onclick="saveNewBorrower()" style="flex:1; min-width: 200px;">ğŸ’¾ Save Data</button>
          </div>
        </div>
      </div>

      <div id="manageScreen" class="screen-panel" style="display:none;">
        <div class="header-row">
          <div>
            <h1 id="displayBorrowerName" style="margin-bottom:5px;"></h1>
            <p id="displayContact" style="margin:0; color:#888; font-size:14px;">ğŸ“ </p>
          </div>
          <button class="delete-icon" onclick="deleteActiveBorrower()">ğŸ—‘ï¸</button>
        </div>
        <div class="section-box" style="background:#f0f8ff;">
          <details>
            <summary style="cursor:pointer; font-weight:bold; color:#2980b9;">ğŸ“‚ View Documents</summary>
            <div style="margin-top:15px; display:flex; gap:10px; flex-wrap:wrap;">
              <div style="flex:1;">
                <small>Valid ID:</small><br>
                <img id="viewValidID" src="" style="width:100%; max-width:150px; border-radius:8px; display:none;">
                <span id="noID" style="font-size:12px; color:#999;">No ID</span>
              </div>
              <div style="flex:1;">
                <small>Signature:</small><br>
                <img id="viewSignature" src="" style="width:100%; max-width:150px; border-radius:8px; display:none;">
                <span id="noSig" style="font-size:12px; color:#999;">No Signature</span>
              </div>
            </div>
          </details>
        </div>
        <div class="section-box locked-info">
          <div class="row">
            <div class="half"><label>Total Due</label><input type="text" id="manageAmount" readonly></div>
            <div class="half"><label>Due Date</label><input type="date" id="manageDueDate" readonly></div>
          </div>
        </div>
        <div class="section-box">
          <h3>Payment Entry</h3>
          <label>Payment Date</label><input type="date" id="paymentDate">
          <label>Payment Time</label><input type="time" id="paymentTime">
          <label style="color:#27ae60;">Amount Paid</label><input type="text" id="amountPaid" oninput="formatInput(this)">
          <div class="rule-box" id="ruleText"></div>
          <button id="finalDownloadBtn" class="download-btn" onclick="downloadSmartReceipt()" style="margin-top:20px; width:100%;">âœ… Confirm Payment & Download Receipt</button>
        </div>
        <div class="button-group" style="margin-top: 10px;">
          <p style="text-align:center; color:#888; font-size:12px; margin:5px;">â€” OR â€”</p>
          <button class="calc-btn" onclick="calculate()">ğŸ” Calculate Breakdown (Preview)</button>
          <button class="copy-btn" onclick="copyToClipboard()">ğŸ“‹ Copy Details to Messenger</button>
        </div>
        <div id="output" class="output-box"></div>
        <div id="breakdown" class="breakdown-box"></div>
      </div>
    </div>
  </div>

  <div id="final-receipt-image" style="position:absolute;left:-9999px;width:400px;background:white;padding:30px;color:black;">
    <div id="receipt-content"></div>
  </div>

  <div id="contract-template-source" style="display:none;">
    <div style="width: 750px; background: white; padding: 50px; color: black; font-family: 'Times New Roman', serif; position: relative;">
      <h2 style="text-align: center; text-decoration: underline; margin-bottom: 30px;">LOAN AGREEMENT</h2>
      
      <p>This Agreement is made this <b id="cDate"></b>, between:</p>
      
      <p><b>THE LENDERS:</b><br>
      Name: <span id="cLender"></span></p>

      <p><b>THE BORROWER:</b><br>
      Name: <span id="cBorrower"></span><br>
      Address: <span id="cAddress"></span><br>
      Contact Number: <span id="cContact"></span></p>

      <h4>1. LOAN DETAILS</h4>
      <p>The Lenders agree to loan the funds detailed below. The Borrower agrees to repay the Total Amount Due by the agreed Due Date.</p>
      <ul>
        <li>Principal Loan Amount: <b>â‚±<span id="cPrincipal"></span></b></li>
        <li>Interest Fee (<span id="cRate"></span>%): <b>â‚±<span id="cInterest"></span></b></li>
        <li>TOTAL AMOUNT DUE: <b>â‚±<span id="cTotal"></span></b></li>
        <li>Due Date: <b><span id="cDueDate"></span></b></li>
      </ul>

      <h4>2. PAYMENT TERMS</h4>
      <p>The Borrower acknowledges that the interest rate is fixed regardless of partial payment.</p>

      <h4>3. LATE PAYMENT PENALTY (STRICT COMPLIANCE)</h4>
      <p>If unpaid by the Due Date:</p>
      <ul>
        <li>Penalty Fee: <b>â‚±<span id="cPenaltyAmt"></span></b> will be charged for every <b><span id="cPenaltyHrs"></span> hours</b> delayed.</li>
      </ul>

      <h4>4. REQUIREMENTS AND SECURITY</h4>
      <p>The Borrower has submitted the following:</p>
      <ul style="list-style: none;">
        <li>[âœ“] Your validated school ID</li>
        <li>[âœ“] Any valid ID of yours</li>
        <li>[âœ“] Any valid ID of one of your relatives</li>
        <li>[âœ“] Your contact number</li>
        <li>[âœ“] Contact number of your relative</li>
        <li>[âœ“] Your E-signature for contract</li>
      </ul>

      <h4>5. DEFAULT AND CONTACT PERMISSION</h4>
      <p>The Borrower grants the Lenders permission to contact the Relative listed above if the Borrower cannot be reached regarding unpaid debts.</p>

      <h4>6. ACKNOWLEDGMENT</h4>
      <p>I, the Borrower, accept these terms. I understand that I owe the Principal plus Interest, and that penalties apply for lateness.</p>

      <br><br>
      <div style="display: flex; justify-content: space-between; margin-top: 30px; align-items: flex-end;">
        <div style="text-align: center; width: 40%;">
          <img id="cSigImage" src="" style="height: 50px; display: block; margin: 0 auto; border-bottom: 1px solid black;">
          <p style="margin-top: 5px;">Signature of Borrower</p>
        </div>
        <div style="text-align: center; width: 50%;">
          <div style="margin-bottom: 20px;">
              <img id="cLender1Sig" src="" style="height: 45px; display: none; margin: 0 auto;">
              <div id="cLender1Line" style="border-bottom: 1px solid black; width: 100%; margin: 0 auto;"></div>
              <p style="margin-top:2px; font-size:12px;">Lender 1 Signature</p>
          </div>
          <div>
              <img id="cLender2Sig" src="" style="height: 45px; display: none; margin: 0 auto;">
              <div id="cLender2Line" style="border-bottom: 1px solid black; width: 100%; margin: 0 auto;"></div>
              <p style="margin-top:2px; font-size:12px;">Lender 2 Signature</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>